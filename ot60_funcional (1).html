<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Orden de Trabajo - CICLOPIT / Teletón</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>
    :root {
      --bg: #f8f8f8;
      --card: #ffffff;
      --bdr: #cccccc;
      --muted: #f0f0f0;
      --txt: #222;
      --accent: #e91e63;
      --accent-2: #c2185b;
      --danger: #d32f2f;
      --danger-2: #b71c1c;
    }
    body { font-family: Arial, sans-serif; margin: 20px; background: var(--bg); color: var(--txt); }
    .container { max-width: 1100px; margin: auto; background: var(--card); padding: 20px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.2); }
    h2 { text-align: center; margin-bottom: 20px; text-transform: uppercase; font-size: 18px; }
    .section { margin-bottom: 20px; }
    .section h3 { font-size: 16px; margin-bottom: 10px; }
    .title-inline { font-size:16px; margin:0 0 10px 0; display:flex; align-items:center; gap:12px; flex-wrap: wrap; }
    .title-inline .nficha input { width:130px; padding:4px; }

    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { border: 1px solid var(--bdr); padding: 6px; text-align: left; vertical-align: top; }
    th { background: var(--muted); }

    input[readonly], textarea[readonly] {
      background: #f9f9f9; border: none; color: #333; width: 100%; font-size: 13px;
    }
    textarea { width: 100%; resize: vertical; min-height: 60px; }

    /* Firma */
    .firma-wrap { display: grid; gap: 8px; }
    .firma-box {
      width: 100%;
      height: 160px;
      border: 1px solid #999;
      border-radius: 6px;
      background: #fff;
      touch-action: none;
    }
    .firma-actions { display:flex; gap:8px; }
    .btn-sm {
      background: var(--muted);
      border: 1px solid var(--bdr);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
    }
    .btn-sm:hover { filter: brightness(0.98); }

    .badge {
      display:inline-block;
      padding: 4px 8px;
      border: 1px solid var(--bdr);
      border-radius: 6px;
      background: #fafafa;
      font-size: 12px;
    }

    .btns { display:flex; gap:10px; margin-top:20px; }
    .btn {
      flex:1;
      border:none;
      padding:12px;
      font-size:16px;
      cursor:pointer;
      border-radius:8px;
      color:#fff;
    }
    .btn-print { background:var(--accent); }
    .btn-print:hover { background:var(--accent-2); }
    .btn-close { background:var(--danger); }
    .btn-close:hover { background:var(--danger-2); }

    small { font-size:11px; color:#555; display:block; margin-top:10px; line-height: 1.35; }

    @media print {
      body { background:#fff; margin:0; }
      .container { box-shadow:none; border-radius:0; padding: 0 0 10px 0; }
      .btn, .btn-sm { display:none !important; }
      .firma-box { border: 1px solid #000; }
      .badge { border: 1px solid #000; }
    }
  </style>
</head>
<body>
<div class="container">
<h2>ORDEN DE TRABAJO - CICLOPIT / TELETÓN</h2>
<!-- Datos del Paciente -->
<div class="section">
<h3>Datos del Paciente</h3>
<table>
<tr>
<td><b>Nombre</b><br/><input readonly="" type="text" value="Carlos Andrés"/></td>
<td><b>Apellido Paterno</b><br/><input readonly="" type="text" value="González"/></td>
<td><b>Apellido Materno</b><br/><input readonly="" type="text" value="Rojas"/></td>
</tr>
</table>
</div>
<!-- Información General -->
<div class="section">
<h3>Información General</h3>
<table>
<tr>
<td><b>N° OT</b><br/><input readonly="" type="text" value="2025-OT-00123"/></td>
<td><b>Fecha de Mantenimiento</b><br/><input readonly="" type="date" value="2025-08-18"/></td>
<td><b>Lugar de Atención</b><br/><input readonly="" type="text" value="Instituto Teletón - Sede Santiago"/></td>
<td>
<b>Entrega Tríptico</b><br/>
<span class="badge">✅ Sí</span>
</td>
</tr>
</table>
</div>
<!-- Voluntarios Asignados -->
<div class="section">
<h3>Voluntarios Asignados</h3>
<table>
<thead>
<tr>
<th>Nombre Completo</th>
<th>RUN</th>
<th>Rol</th>
</tr>
</thead>
<tbody>
<tr>
<td><input readonly="" type="text" value="César Jiménez"/></td>
<td><input readonly="" type="text" value="12.345.678-9"/></td>
<td><input readonly="" type="text" value="Voluntario CICLOPIT"/></td>
</tr>
<tr>
<td><input readonly="" type="text" value="María López"/></td>
<td><input readonly="" type="text" value="9.876.543-2"/></td>
<td><input readonly="" type="text" value="Voluntario CICLOPIT"/></td>
</tr>
</tbody>
</table>
</div>
<!-- Ayudas Técnicas Intervenidas -->
<div class="section">
<h3 class="title-inline">
        Ayudas Técnicas Intervenidas
        <span class="nficha">N° Ficha: <input readonly="" type="text" value="121212"/></span>
</h3>
<textarea readonly="">Cambio de rueda derecha de silla de ruedas por desgaste. Se realizó revisión general y ajuste de la estructura.</textarea>
<h4 style="margin-top:15px;">Repuestos Cambiados</h4>
<table>
<thead>
<tr>
<th>Repuesto</th>
<th>Cantidad</th>
</tr>
</thead>
<tbody>
<tr>
<td><input readonly="" type="text" value="Rueda trasera 24 pulgadas"/></td>
<td><input readonly="" type="text" value="1"/></td>
</tr>
<tr>
<td><input readonly="" type="text" value="Tornillos de sujeción"/></td>
<td><input readonly="" type="text" value="4"/></td>
</tr>
</tbody>
</table>
</div>
<!-- Tutor Responsable -->
<div class="section">
<h3>Tutor Responsable</h3>
<table>
<tr>
<td><b>Nombre</b><br/><input readonly="" type="text" value="Juan Pérez"/></td>
<td><b>RUN</b><br/><input readonly="" type="text" value="11.111.111-1"/></td>
<td><b>Correo</b><br/><input readonly="" type="email" value="juanperez@ejemplo.cl"/></td>
<td>
<b>Firma Digital (editable)</b><br/>
<div class="firma-wrap">
<canvas class="firma-box" id="firma"></canvas>
<div class="firma-actions">
<button class="btn-sm" id="limpiarFirma" type="button">Limpiar</button>
</div>
</div>
</td>
</tr>
</table>
</div>
<small>
      *Doy fe que las asistencias técnicas detalladas han sido realizadas conforme a los estándares del programa CICLOPIT por los voluntarios registrados. Confirmo haber recibido el servicio técnico y que los dispositivos se encuentran en condiciones funcionales al momento de la entrega.*
    </small>
<!-- Botones de acción -->
<div class="btns">
<button class="btn btn-print" onclick="window.print()">Imprimir / Guardar como PDF</button>
<button class="btn btn-close" onclick="window.close()">Cerrar Ventana</button>
</div>
</div>
<script>
    // Firma en canvas
    (function(){
      const canvas = document.getElementById('firma');
      const ctx = canvas.getContext('2d');
      let drawing = false, lastX = 0, lastY = 0;

      function resizeCanvas() {
        const data = canvas.toDataURL();
        const img = new Image();
        img.onload = function() {
          canvas.width = canvas.clientWidth;
          canvas.height = canvas.clientHeight;
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = data;
      }
      function initSize() {
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
      }
      initSize();
      window.addEventListener('resize', resizeCanvas);

      ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.lineWidth = 2;

      function getPos(e){
        const r = canvas.getBoundingClientRect();
        if (e.touches && e.touches[0]) {
          return { x: e.touches[0].clientX - r.left, y: e.touches[0].clientY - r.top };
        } else {
          return { x: e.clientX - r.left, y: e.clientY - r.top };
        }
      }
      function start(e){ drawing = true; const p = getPos(e); lastX = p.x; lastY = p.y; e.preventDefault();}
      function move(e){ if(!drawing) return; const p = getPos(e); ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(p.x, p.y); ctx.stroke(); lastX=p.x; lastY=p.y; e.preventDefault();}
      function end(){ drawing=false; }

      canvas.addEventListener('mousedown', start);
      canvas.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);
      canvas.addEventListener('touchstart', start, {passive:false});
      canvas.addEventListener('touchmove', move, {passive:false});
      canvas.addEventListener('touchend', end);

      document.getElementById('limpiarFirma').addEventListener('click', ()=>ctx.clearRect(0,0,canvas.width,canvas.height));
    })();
  </script>

<h4>Firma Digital (editable)</h4>
<canvas height="100" id="firmaCanvas" style="border:1px solid #000;" width="300"></canvas><br/>
<button onclick="limpiarFirma()">Limpiar Firma</button>

<br/><br/>
<button onclick="window.print()">Imprimir / Guardar como PDF</button>
<button onclick="window.close()">Cerrar Ventana</button>

<script>
let canvas = document.getElementById('firmaCanvas');
let ctx = canvas.getContext('2d');
let dibujando = false;

canvas.addEventListener('mousedown', () => dibujando = true);
canvas.addEventListener('mouseup', () => dibujando = false);
canvas.addEventListener('mousemove', dibujar);

function dibujar(e) {
  if (!dibujando) return;
  ctx.lineTo(e.offsetX, e.offsetY);
  ctx.stroke();
}

function limpiarFirma() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}
</script>
</body>
</html>

